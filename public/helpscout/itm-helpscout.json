{
  "name": "itm-helpscout",
  "svgString": "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512' width='56' height='45' fill='#03363d'><path d='M173.82 40.5v112.86H80.34L173.82 40.5zm0-40.5a46.74 46.74 0 1 1-93.48 0h93.48zm15.4 153.37a46.74 46.74 0 0 1 93.48 0h-93.48zm0-40.5V0h93.5l-93.5 112.86zm52.28 137.06a18.22 18.22 0 0 0 12.95-5l6.42 6.93c-4.24 4.36-10.12 7.6-19.26 7.6-15.67 0-25.8-10.4-25.8-24.46a24 24 0 0 1 24.37-24.47c15.56 0 24.38 11.84 23.6 28.26H227c1.3 6.82 6.1 11.17 14.47 11.17m11.2-19c-1-6.37-4.8-11.06-12.4-11.06-7.07 0-12 4-13.27 11.06h25.68zM0 249.4l28.3-28.76H.67v-9.02h40.76v9.2l-28.3 28.75h28.7v9.03H0v-9.2zm73.6.52a18.22 18.22 0 0 0 12.95-5l6.42 6.93c-4.24 4.36-10.12 7.6-19.26 7.6-15.67 0-25.8-10.4-25.8-24.46a24 24 0 0 1 24.37-24.47c15.56 0 24.38 11.84 23.6 28.26H59.12c1.3 6.82 6.1 11.17 14.47 11.17m11.2-19c-1-6.37-4.8-11.06-12.4-11.06-7.07 0-12 4-13.27 11.06H84.8zm72.23 4.03c0-15 11.23-24.44 23.6-24.44a20.34 20.34 0 0 1 15.67 7.05v-27.72h10v68.6h-10V252a20.1 20.1 0 0 1-15.76 7.42c-12 0-23.5-9.5-23.5-24.43m39.82-.1a14.92 14.92 0 1 0-14.91 15.32c8.6 0 14.9-6.86 14.9-15.32m73.48 13.6l9.06-4.7a13.44 13.44 0 0 0 12.08 6.86c5.66 0 8.6-2.9 8.6-6.2 0-3.76-5.47-4.6-11.42-5.83-8-1.7-16.33-4.33-16.33-14 0-7.43 7.07-14.3 18.2-14.2 8.77 0 15.3 3.48 19 9.1l-8.4 4.6a12.19 12.19 0 0 0-10.57-5.36c-5.38 0-8.12 2.63-8.12 5.64 0 3.38 4.34 4.32 11.14 5.83 7.74 1.7 16.5 4.23 16.5 14 0 6.48-5.66 15.22-19.06 15.13-9.8 0-16.7-3.95-20.67-10.9m66.9-10.87l-7.93 8.65v12.2h-10v-68.6h10v44.93l21.23-23.3h12.18l-18.4 20.1 18.88 26.88h-11.32l-14.63-20.86zM126.8 210.53c-11.9 0-21.85 7.7-21.85 20.5v27.45h10.2V232.3c0-7.7 4.43-12.32 12-12.32s11.33 4.6 11.33 12.32v26.18h10.14v-27.45c0-12.78-10-20.5-21.85-20.5'/></svg>",
  "details": {
    "title": {
      "en": "ITMToHelpscout",
      "es": "ITMToHelpscout",
      "pt": "ITMToHelpscout"
    },
    "version": "0.0.1",
    "shortDescription": {
      "en": "",
      "es": "",
      "pt": ""
    },
    "longDescription": {
      "en": "",
      "es": "",
      "pt": ""
    }
  },
  "features": [
    {
      "trigger": "event",
      "connector": "itm-helpscout",
      "AccountId": "@@AccountId@@",
      "entity": "Task",
      "description": "Task update Event, which will update 'Ticket' in Ticketing Platform",
      "condition": "input.diff != null && input.diff.StatusId != null && input.diff.StatusId.new != null && Convert.ToInt32(input.diff.StatusId.new) == Convert.ToInt32(config.ready_to_reply_status_id) && Convert.ToInt32(input.userId) != -99",
      "event": "updated",
      "async": true,
      "actions": [
        {
          "action": "restcall",
          "url": "@@TaskMS@@/v2/{{ input.accountId }}/Projects/{{ input.projectId }}/Tasks/{{ input.task.Id }}",
          "method": "POST",
          "description": "(1) Getting CustomFields values for project of ITM.",
          "output": "customfields",
          "payload": "{\"columns\":{\"$in\":[\"AllCustomFields\"]}}",
          "dataType": "application/json"
        },
        {
          "action": "restcall",
          "url": "{{ config.url }}/v2/oauth2/token",
          "method": "POST",
          "payload": "{\"grant_type\":\"client_credentials\",\"client_id\":\"{{ config.client_id }}\",\"client_secret\":\"{{ config.client_secret }}\"}",
          "description": "Get Ticketing User List",
          "output": "authToken",
          "dataType": "application/json"
        },
        {
          "action": "restcall",
          "url": "{{ config.url }}/v2/users?email={{ config.front_desk_support_email }}",
          "method": "GET",
          "payload": "",
          "description": "Get Ticketing User List",
          "output": "frontDeskSupportUsersOutput",
          "dataType": "application/json",
          "headers": "{\"Authorization\": \"Bearer {{authToken.access_token}}\"}"
        },
        {
          "action": "restcall",
          "url": "{{ config.url }}/v2/conversations/{{ customfields.AllCustomFields.TicketURL }}",
          "method": "PATCH",
          "description": "Update Ticket",
          "condition": "input.diff != null && input.diff.StatusId != null && input.diff.StatusId.new != null && Convert.ToInt32(input.diff.StatusId.new) == {{config.ready_to_reply_status_id}} && frontDeskSupportUsersOutput != null && Convert.ToInt32(frontDeskSupportUsersOutput.page.number) > 0 && customfields.AllCustomFields != null && Convert.ToString(customfields.AllCustomFields.TicketURL) != null",
          "payload": "{\"op\":\"replace\",\"path\":\"/assignTo\",\"value\":\"{{ frontDeskSupportUsersOutput._embedded.users.0.id }}\"}",
          "dataType": "application/json",
          "authentication": "bearer",
          "headers": "{\"Authorization\": \"Bearer {{authToken.access_token}}\"}"
        }
      ]
    },
    {
      "trigger": "webhook",
      "connector": "itm-helpscout",
      "AccountId": "@@AccountId@@",
      "entity": "Task",
      "description": "Create or Update Task in ITM from Ticketing platform",
      "condition": "input.id != null && Convert.ToInt64(input.id) != 0",
      "event": "updated",
      "async": true,
      "authentication":false, 
      "actions": [
        {
          "action": "restcall",
          "url": "@@TaskMS@@/v2/{{ input.accountId }}/Projects/Search",
          "method": "POST",
          "condition": "input.id != null && Convert.ToInt64(input.id) != 0 && Convert.ToString(input.primaryCustomer.email) != \"\"",
          "description": "Getting Project Team Members",
          "output": "teamMembers",
          "payload": "{\"columns\":{\"$in\":[\"Team.TeamMembers\",\"Team.Managers\"]},\"Filter\":{\"id\":{{ config.projectId }},\"Team.TeamMembers.EmailAddress\":\"{{ input.primaryCustomer.email }}\"}}",
          "dataType": "application/json"
        },
        {
          "action": "restcall",
          "url": "@@TaskMS@@/v2/{{ input.accountId }}/Projects/Search",
          "method": "POST",
          "condition": "input.id != null && Convert.ToInt64(input.id) != 0 && Convert.ToString(input.primaryCustomer.email) != \"\" && Convert.ToInt32(teamMembers.total) == 0",
          "description": "Getting Project Team Members",
          "output": "teamMembers",
          "payload": "{\"columns\":{\"$in\":[\"Team.TeamMembers\",\"Team.Managers\"]},\"Filter\":{\"id\":{{  config.projectId }},\"Team.Managers.EmailAddress\":\"{{ input.primaryCustomer.email }}\"}}",
          "dataType": "application/json"
        },
        {
          "action": "validate",
          "validateCondition": "input.id != null && Convert.ToInt64(input.id) != 0 && Convert.ToString(input.primaryCustomer.email) != \"\" && Convert.ToString(input.primaryCustomer.email) != Convert.ToString(config.front_desk_support_email) && (Convert.ToInt32(teamMembers.total) == 0)",
          "message": "The ticket assignee must be a member of the project team or the front-desk support email. Please update the assignee before proceeding."
        },
        {
          "action": "restcall",
          "url": "@@TaskMS@@/v2/{{ input.accountId }}/tasks/CustomFields",
          "method": "GET",
          "description": "Get Project Task Custom Fields",
          "output": "AllCustomFieldsOutput",
          "condition": "input.id != null && Convert.ToInt64(input.id) != 0 && Convert.ToString(input.primaryCustomer.email) != \"\"",
          "payload": "",
          "dataType": "application/json"
        },
        {
          "action": "restcall",
          "url": "@@TaskMS@@/v2/{{ input.accountId }}/Projects/{{ config.projectId }}/Tasks/{{  mapArray input.customFields 'name' 'ITMTaskId' 'value' }}?UserId=-99&LanguageId=@@LanguageId@@",
          "method": "PATCH",
          "description": "Update Existing Task",
          "output": "taskOutput",
          "condition": "input.id != null && Convert.ToInt64(input.id) != 0 && Convert.ToString(input.primaryCustomer.email) != \"\" && \"{{  mapArray input.customFields 'name' 'ITMTaskId' 'value' }}\" != \"\"",
          "payload": "{\"Name\":\"{{input.subject}}\",\"StatusId\":\"{{ config.initial_status_id }}\",\"Details\":\"{{ input.preview }}\",\"TaskMembers\":\"{{ input.primaryCustomer.email }}\"}",
          "dataType": "application/json"
        },
        {
          "action": "restcall",
          "url": "@@TaskMS@@/v2/{{ input.accountId }}/Projects/{{ config.projectId }}/Tasks?UserId=-99&LanguageId=@@LanguageId@@",
          "method": "POST",
          "description": "Create New Task",
          "output": "taskOutput",
          "condition": "input.id != null && Convert.ToInt64(input.id) != 0 && Convert.ToString(input.primaryCustomer.email) != \"\" && \"{{  mapArray input.customFields 'name' 'ITMTaskId' 'value' }}\" == \"\"",
          "payload": "{\"Name\":\"{{input.subject}}\",\"StatusId\":\"{{ config.initial_status_id }}\",\"TaskMembers\":\"{{ input.primaryCustomer.email }}\",\"CustomField\":[ {{#ifEquals AllCustomFieldsOutput.Name 'TicketURL'}}  {{else}} {\"CustomFieldBaseId\":{{ mapArray AllCustomFieldsOutput 'Name' 'TicketURL' 'Id'}},\"CustomFieldValue\":\"{{ input.id }}\",\"CustomFieldTypeName\":\"Text\"} {{/ifEquals}}],\"KindId\":3}",
          "dataType": "application/json"
        }
      ]
    }
  ],
  "config": [
    {
      "name": "isactive",
      "label": {
        "en": "Activate extension",
        "es": "Activar extensión",
        "pt": "Ativar o extensões"
      },
      "tooltip": {
        "en": "",
        "es": "",
        "pt": ""
      },
      "type": "checkbox",
      "required": false
    },
    {
      "name": "url",
      "label": {
        "en": "Helpscout URL",
        "es": "URL de Helpscout",
        "pt": "Helpscout URL"
      },
      "tooltip": {
        "en": "URL of the Helpscout account",
        "es": "URL de la cuenta de Helpscout",
        "pt": "URL da conta Helpscout"
      },
      "type": "string",
      "required": true
    },
    {
      "name": "front_desk_support_email",
      "label": {
        "en": "Front desk support email",
        "es": "orreo electrónico de soporte de recepción",
        "pt": "E-mail de suporte da recepção"
      },
      "tooltip": {
        "en": "Front desk support email",
        "es": "Correo electrónico de soporte de recepción",
        "pt": "E-mail de suporte da recepção"
      },
      "type": "string",
      "required": true
    },
    {
      "name": "client_id",
      "label": {
        "en": "Client Id",
        "es": "Client Id",
        "pt": "Client Id"
      },
      "tooltip": {
        "en": "Client Id that generated from Helpscout",
        "es": "Client Id that generated from Helpscout",
        "pt": "Client Id that generated from Helpscout"
      },
      "type": "string",
      "required": true
    },
    {
      "name": "client_secret",
      "label": {
        "en": "Client Secret",
        "es": "Client Secret",
        "pt": "Client Secret"
      },
      "tooltip": {
        "en": "Client Secret that generated from Helpscout",
        "es": "Client Secret that generated from Helpscout",
        "pt": "Client Secret that generated from Helpscout"
      },
      "type": "string",
      "required": true
    },
    {
      "name": "projectId",
      "label": {
        "en": "Project Id",
        "es": "Project Id",
        "pt": "Project Id"
      },
      "tooltip": {
        "en": "Project Id",
        "es": "Project Id",
        "pt": "Project Id"
      },
      "type": "string",
      "required": true
    },
    {
      "name": "initial_status_id",
      "label": {
        "en": "Intial Status Id",
        "es": "Intial Status Id",
        "pt": "Intial Status Id"
      },
      "type": "dropdown",
      "data": {
        "isFromITM": true,
        "method": "GET",
        "url": "v2/@@companyId@@/Projects/@@projectId@@/GetKanbanTaskStatus",
        "id": "Id",
        "name": "Name",
        "columnName": {
          "en": "ITM",
          "es": "ITM",
          "pt": "ITM"
        }
      }
    },
    {
      "name": "ready_to_reply_status_id",
      "label": {
        "en": "Ready To Reply Status Id",
        "es": "Ready To Reply Status Id",
        "pt": "Ready To Reply Status Id"
      },
      "type": "dropdown",
      "data": {
        "isFromITM": true,
        "method": "GET",
        "url": "v2/@@companyId@@/Projects/@@projectId@@/GetKanbanTaskStatus",
        "id": "Id",
        "name": "Name",
        "columnName": {
          "en": "ITM",
          "es": "ITM",
          "pt": "ITM"
        }
      }
    }
  ],
  "updated": "22-01-2025"
}